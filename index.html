<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đọc Excel danh sách học sinh</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, select { margin: 5px; padding: 6px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #444; padding: 8px 12px; text-align: center; }
    th { background-color: #f2f2f2; }
    tr:hover { background-color: #f9f9f9; }
  </style>
</head>
<body>
  <h2>Upload file Excel danh sách học sinh</h2>
  
  <input type="file" id="fileInput" accept=".xlsx, .xls">
  <br>
  <label>Sắp xếp theo: </label>
  <select id="sortOrder" onchange="renderTable(students)">
    <option value="desc">Điểm giảm dần</option>
    <option value="asc">Điểm tăng dần</option>
  </select>

  <label>Tìm kiếm tên: </label>
  <input type="text" id="search" placeholder="Nhập tên..." onkeyup="filterTable()">

  <div id="result"></div>
  
  <script>
    let students = [];

    function getRank(score) {
      if (score >= 8.5) return "Giỏi";
      if (score >= 7) return "Khá";
      if (score >= 5) return "Trung bình";
      return "Yếu";
    }

    document.getElementById("fileInput").addEventListener("change", handleFile);

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        students = [];
        for (let i = 1; i < json.length; i++) { // bỏ dòng tiêu đề
          const row = json[i];
          if (row && row.length >= 2) {
            const name = row[0];
            const score = parseFloat(row[1]);
            if (!isNaN(score)) {
              students.push({ name, score });
            }
          }
        }
        renderTable(students);
      };
      reader.readAsArrayBuffer(file);
    }

    function renderTable(data) {
      const order = document.getElementById("sortOrder").value;
      const sorted = [...data].sort((a, b) => order === "desc" ? b.score - a.score : a.score - b.score);

      let result = "<h3>Kết quả sắp xếp</h3>";
      result += "<table id='studentTable'><tr><th>STT</th><th>Tên</th><th>Điểm</th><th>Xếp loại</th></tr>";
      sorted.forEach((s, i) => {
        result += `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.score}</td><td>${getRank(s.score)}</td></tr>`;
      });
      result += "</table>";
      document.getElementById("result").innerHTML = result;
    }

    function filterTable() {
      const keyword = document.getElementById("search").value.toLowerCase();
      const filtered = students.filter(s => s.name.toLowerCase().includes(keyword));
      renderTable(filtered);
    }
  </script>
</body>
</html>
