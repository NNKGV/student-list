<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Top 30 há»c sinh Ä‘iá»ƒm cao nháº¥t</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { margin: 5px; padding: 6px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #444; padding: 8px 12px; text-align: center; }
    th { background-color: #f2f2f2; }
    tr:hover { background-color: #f9f9f9; }
  </style>
</head>
<body>
  <h2>Upload file Excel danh sÃ¡ch há»c sinh</h2>

  <input type="file" id="fileInput" accept=".xlsx,.xls">
  <br><br>
  <label>TÃ¬m kiáº¿m tÃªn: </label>
  <input type="text" id="search" placeholder="Nháº­p tÃªn..." onkeyup="filterTable()">

  <div id="result"></div>

  <!-- ThÆ° viá»‡n Ä‘á»c Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let students = [];

    document.getElementById("fileInput").addEventListener("change", function(e) {
      let file = e.target.files[0];
      let reader = new FileReader();

      reader.onload = function(e) {
        let data = new Uint8Array(e.target.result);
        let workbook = XLSX.read(data, { type: "array" });

        // Láº¥y sheet Ä‘áº§u tiÃªn
        let sheet = workbook.Sheets[workbook.SheetNames[0]];
        let rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        console.log("Excel Ä‘á»c Ä‘Æ°á»£c:", rows); // ğŸ‘ˆ debug á»Ÿ Ä‘Ã¢y

        students = [];

        // Giáº£ sá»­ Excel cÃ³ dáº¡ng: TÃªn | Äiá»ƒm
        for (let i = 1; i < rows.length; i++) {
          let row = rows[i];
          if (row[0] && row[1]) {
            students.push({ name: row[0], score: Number(row[1]) });
          }
        }

        console.log("Danh sÃ¡ch há»c sinh:", students); // ğŸ‘ˆ debug tiáº¿p

        renderTable(students);
      };

      reader.readAsArrayBuffer(file);
    });

    function renderTable(data) {
      let sorted = [...data].sort((a, b) => b.score - a.score);
      sorted = sorted.slice(0, 30); // chá»‰ láº¥y top 30

      let result = "<h3>Top 30 há»c sinh Ä‘iá»ƒm cao nháº¥t</h3>";
      result += "<table id='studentTable'><tr><th>STT</th><th>TÃªn</th><th>Äiá»ƒm</th></tr>";
      sorted.forEach((s, i) => {
        result += `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.score}</td></tr>`;
      });
      result += "</table>";
      document.getElementById("result").innerHTML = result;
    }

    function filterTable() {
      const keyword = document.getElementById("search").value.toLowerCase();
      const filtered = students.filter(s => s.name.toLowerCase().includes(keyword));
      renderTable(filtered);
    }
  </script>
</body>
</html>
